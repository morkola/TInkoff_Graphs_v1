var e=Object.defineProperty,t=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,l=(t,a,s)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[a]=s,n=(e,n)=>{for(var u in n||(n={}))a.call(n,u)&&l(e,u,n[u]);if(t)for(var u of t(n))s.call(n,u)&&l(e,u,n[u]);return e};import{o as u,c as i,r,p as c,a as o,b as d,d as y,e as v,f as p,g as h,h as m,u as x,i as f,t as b,F as g,j as k,k as w,w as S,l as M,v as V,m as P,n as $,q as B,s as C,x as F,T as j,y as L,z as O,A as E,B as N,C as _,D as q,E as D}from"./vendor.4efa5d83.js";const T={};T.render=function(e,t){const a=r("router-view");return u(),i(a)};c("data-v-4c861d0a");const A={class:"graph-wrapper"},I={class:"price"},z={class:"current-price"},U={key:0},R={key:1},Y={key:2},K=$('<div class="axis-x" data-v-4c861d0a><div class="x-item" data-v-4c861d0a>Янв</div><div class="x-item" data-v-4c861d0a>Фев</div><div class="x-item" data-v-4c861d0a>Мар</div><div class="x-item" data-v-4c861d0a>Апр</div><div class="x-item" data-v-4c861d0a>Май</div><div class="x-item" data-v-4c861d0a>Июн</div><div class="x-item" data-v-4c861d0a>Июл</div><div class="x-item" data-v-4c861d0a>Авг</div><div class="x-item" data-v-4c861d0a>Сен</div><div class="x-item" data-v-4c861d0a>Окт</div><div class="x-item" data-v-4c861d0a>Ноя</div><div class="x-item" data-v-4c861d0a>Дек</div></div>',1),G={class:"graph-year"},H={class:"footer"},J={class:"container"},Q={key:0,class:"price"},W={class:"current-price"},X={key:2,style:{position:"relative"}};o();const Z={expose:[],props:{points:Array,duration:Number,id:String,currency:String,year:Number},setup(e){const t=e,{points:a,duration:s}=t;d(400),d(400),d(0),d(0);const l=d(0),r=y({width:1e3,height:400,x:-30,y:0}),c=v((()=>s/a.length));let o=y({currentMoney:0,lastBuy:{value:0,delta:0,stocks:0,deltaPerc:0},purchases:[],startSum:null,savedNum:null,isStarted:!1,isMount:!1,saved:null,selled:null,isPause:!1,timeout:null,values:v((()=>[...a].map((e=>e[1])))),maxValue:v((()=>[...a].reduce(((e,t)=>null===e||+t[1]>e?+t[1]:e),null))),minValue:v((()=>[...a].reduce(((e,t)=>null===e||e>t[1]?t[1]:e),null))),steps:v((()=>[...a].length))}),$=v((()=>[{x:0,value:o.minValue,y:o.minValue&&o.maxValue?se(0,o.minValue).y:0},{x:0,value:o.maxValue,y:o.minValue&&o.maxValue?se(0,o.maxValue).y:0},{x:0,value:o.minValue&&o.maxValue?o.minValue+(o.maxValue-o.minValue)/2:0,y:o.minValue&&o.maxValue?se(0,o.minValue+(o.maxValue-o.minValue)/2).y:0}]));const B=v((()=>a.reduce(((e,t)=>(e.push(se(t[0],t[1])),e)),[]))),C=v((()=>B.value.reduce(((e,t,a,s)=>{if(a){const l=s[a-1],n=t;e.push(`M${l.x} ${l.y}, ${n.x} ${n.y}`)}return e}),[]))),F=v((()=>{const e=B.value[0],t=B.value[l.value];return B.value.reduce(((a,s,n,u)=>(0===n?a+=`M${e.x},${e.y}`:n<=l.value?a+=` L${s.x},${s.y}`:a+=` L${t.x},${t.y}`,a)),"")}));v((()=>[...C.value].filter(((e,t)=>t<l.value))));const j=v((()=>o.purchases.reduce(((e,t)=>(t.buy&&e.push(n({type:"buy",value:t.buy},se(t.buyPoint.x,t.buyPoint.y))),t.sell&&e.push(n({type:"sell",value:t.sell},se(t.sellPoint.x,t.sellPoint.y))),e)),[]))),L=v((()=>a[l.value]));v((()=>+(l.value>0?a[l.value][1]-a[l.value-1][1]:0).toFixed(2)));const O=d(!1),E=v((()=>o.purchases&&o.purchases.length?o.purchases[o.purchases.length-1]:null)),N=v((()=>{if(E.value&&E.value.sell){const e=+o.startSum.replace(/[^0-9]/gi,""),t=E.value.buy,a=E.value.sell,s=Math.floor(e/t),l=e-s*t,n=t*s,u=a*s;return{sum:u+l,value:u-n,perc:u?100*(u-n+l)/u:0}}return null}));const _=d(null);function q(){clearTimeout(o.timeout),O.value=!1}function D(){q(),o.isPause=!0}function T(){clearTimeout(o.timeout),o.isStarted||(o.currentMoney=+o.startSum.replace(/[^0-9]/gi,"")),o.isStarted=!0,O.value=!0,o.isPause=!1,Z()}function Z(){var e;(e=l.value)+1<o.steps?l.value=e+1:(null==o.selled&&null!=o.saved&&te(),q()),O.value&&(o.timeout=setTimeout((()=>{Z()}),1e3*c.value))}function ee(){o.saved=a[l.value];const e=o.saved[1];o.savedNum=Math.floor(o.currentMoney/e),o.purchases.push({buy:o.saved[1],buyPoint:{x:o.saved[0],y:o.saved[1]},sell:null,sellPoint:null}),o.currentMoney-=o.savedNum*e,D()}function te(){const e=a[l.value];o.selled=e;const t=o.currentMoney,s=o.savedNum*e[1],n=o.purchases[o.purchases.length-1].buy*o.savedNum;o.currentMoney+=s+t,o.purchases[o.purchases.length-1].sell=e[1],o.purchases[o.purchases.length-1].sellPoint={x:e[0],y:e[1]},o.lastBuy.value=e[1],o.lastBuy.stocks=o.savedNum,o.lastBuy.delta=s-n,o.lastBuy.deltaPerc=+(100*o.lastBuy.delta/(n+t)).toFixed(2),o.savedNum=0,o.saved=null,o.selled=null}function ae(){te(),D()}function se(e,t){const a=(r.width-35-0)/o.steps,s=(r.height-80-20)/(o.maxValue-o.minValue);return{x:0+e*a,y:r.height-40-t*s+o.minValue*s}}function le(){const{width:e,height:t}=_.value.getBoundingClientRect();r.width=Math.round(e),r.height=Math.round(t)}function ne(e){if(e.code&&"keyw"===e.code.toLowerCase())if(o.isStarted){if(o.isStarted&&!o.isPause&&O.value&&!o.saved&&!(o.currentMoney<L.value[1]))return void ee();if(!o.isPause&&O.value&&o.saved&&!N.value)return void ae();o.isPause&&T()}else o.currentMoney=o.startSum.replace(/[^0-9]/gi,""),o.currentMoney&&o.currentMoney>=o.minValue&&(T(),e.preventDefault(),e.stopPropagation())}function ue(e){e.code&&"keyw"===e.code.toLowerCase()&&(e.preventDefault(),e.stopPropagation(),o.startSum=(o.startSum||"").replace(/[^0-9]/gi,""))}return p((()=>{const{width:e,height:t}=_.value.getBoundingClientRect();l.value=0,r.width=Math.round(e),r.height=Math.round(t),window.addEventListener("resize",le),window.addEventListener("keyup",ne),o.isMount=!0})),h((()=>{window.removeEventListener("resize",le)})),(a,s)=>(u(),i(g,null,[m("div",A,[m("div",I,[m("div",z,[x(E)?f("",!0):(u(),i("span",U," ")),x(E)&&null==x(E).sell?(u(),i("span",R,b((+x(E).buy.toFixed(2)).toLocaleString("ru")+(t.currency?" "+t.currency:" ₽")),1)):f("",!0),x(E)&&null!=x(E).sell?(u(),i("span",Y,b((+x(E).sell.toFixed(2)).toLocaleString("ru")+(t.currency?" "+t.currency:" ₽")),1)):f("",!0)])]),m("div",{ref:_,class:"graph-container"},[K,(u(),i("svg",{class:"graph",width:x(r).width+10,height:x(r).height,viewBox:`${x(r).x} ${x(r).y} ${x(r).width+10} ${x(r).height}`,fill:"none",xmlns:"http://www.w3.org/2000/svg"},[m("path",{class:"axis",d:`M0 ${x(r).height}, ${x(r).width} ${x(r).height}`},null,8,["d"]),(u(!0),i(g,null,k(x($),(e=>(u(),i(g,{key:e.value},[m("path",{class:"y-line",d:`M0 ${e.y}, ${x(r).width} ${e.y}`},null,8,["d"]),m("text",{x:"-25",y:e.y+4,class:"y-text"},b(e.value<1?(+e.value.toFixed(2)).toLocaleString("ru"):Math.round(e.value)),9,["y"])],64)))),128)),m("path",{class:"axis",d:`M0 ${x(r).height}, 0 0`},null,8,["d"]),(u(!0),i(g,null,k(x(j),((e,t)=>(u(),i(g,{key:t},[m("line",{x1:e.x,y1:e.y-30,x2:e.x,y2:x(r).height,stroke:"black"},null,8,["x1","y1","x2","y2"]),m("line",{x1:e.x-5,y1:e.y-30,x2:e.x+5,y2:e.y-30,stroke:"black"},null,8,["x1","y1","x2","y2"])],64)))),128)),m("path",{class:["line-path",{"is-animate":O.value}],style:{opacity:x(o).isStarted?1:0,transition:x(o).isStarted?1.5*x(c)+"s":void 0},"stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",d:x(F)},null,14,["d"]),(u(!0),i(g,null,k(x(j),((e,t)=>(u(),i(g,{key:t},[m("circle",{cx:e.x,cy:e.y,r:"5",class:["point-circle",{"buy-point":"buy"===e.type,"sell-point":"sell"===e.type}]},null,10,["cx","cy"]),m("text",{"text-anchor":"end",x:e.x+8,y:e.y-40,class:["point-text",{"buy-point":"buy"===e.type,"sell-point":"sell"===e.type}]},b((+e.value.toFixed(2)).toLocaleString("ru")),11,["x","y"])],64)))),128))],8,["width","height","viewBox"]))],512)]),m("div",G,b(e.year)+" год",1),m("div",H,[m("div",J,[x(N)?(u(),i("div",Q,[m("div",W,b((+x(o).currentMoney.toFixed(2)).toLocaleString("ru")+(t.currency?" "+t.currency:" ₽")),1),x(o).lastBuy.delta?(u(),i("div",{key:0,class:["current-diff",{up:x(o).lastBuy.delta>0,down:x(o).lastBuy.delta<0}]},[x(o).lastBuy.delta?(u(),i("div",{key:0,class:["arrow",{up:x(o).lastBuy.delta>0,down:x(o).lastBuy.delta<0}]},null,2)):f("",!0),w(" "+b((+Math.abs(x(o).lastBuy.delta).toFixed(2)).toLocaleString("ru"))+" "+b(t.currency?" "+t.currency:" ₽"),1)],2)):f("",!0)])):f("",!0),x(o).isStarted?f("",!0):(u(),i("form",{key:1,onSubmit:S(T,["prevent"]),style:{position:"relative"}},[M(m("input",{type:"text",class:"text-input","onUpdate:modelValue":s[1]||(s[1]=e=>x(o).startSum=e),onKeydown:ue,placeholder:"Ваша сумма "+(t.currency?" "+t.currency:" ₽")},null,40,["placeholder"]),[[V,x(o).startSum]]),m("button",{disabled:!(x(o).startSum&&x(o).startSum>=x(o).minValue&&x(o).isMount),type:"submit",class:"button"}," Старт ",8,["disabled"])],40,["onSubmit"])),M(m("button",{class:"button fade-animation",style:{background:"green"},onClick:T}," Продолжить ",512),[[P,x(o).isPause]]),O.value&&x(o).isStarted?(u(),i("div",X,[M(m("button",{class:"button fade-animation",style:{background:"green"},onClick:ee,disabled:x(o).startSum<x(L)[1]}," Купить ",8,["disabled"]),[[P,O.value&&!x(o).saved]]),M(m("button",{class:"button fade-animation",style:{background:"red"},onClick:ae}," Продать ",512),[[P,O.value&&x(o).saved&&!x(N)]])])):f("",!0)])])],64))},__scopeId:"data-v-4c861d0a"};const ee=L();c("data-v-1bb6e375");const te={class:"app-container"},ae={class:"header"},se={class:"container"},le={key:0,class:"title-container"},ne={class:"subtitle"},ue={class:"container"};o();const ie={expose:[],setup(e){const t=F(),a=y({points:[],duration:40,currency:"",isBucks:!1,bucksCourse:75});let s=[[0,10],[10,30],[20,20],[30,50],[40,20]];s=new Array(365),s.fill([0,0]);let l=d(null);async function n(e){const t=await fetch(`data/${e}.json`).then((e=>e.json())),l=t.reduce(((e,t)=>{var a;return e[(a=new Date(t["<DATE>"]),(Date.UTC(a.getFullYear(),a.getMonth(),a.getDate())-Date.UTC(a.getFullYear(),0,0))/24/60/60/1e3)-1]=t["<CLOSE>"],e}),{});let n=t[0]["<CLOSE>"];a.points.push(...s.map(((e,t,s)=>{const u=null!=l[t]?l[t]:n;return n=u,[t,a.isBucks?u*a.bucksCourse:u]})))}async function c(){try{const e=await async function(){try{return await fetch("data/settings.json").then((e=>e.json()))}catch(e){}}();if(a.duration=e.time||40,a.bucksCourse=e.bucksCourse||75,!Array.isArray(e.sources))return Promise.reject();if(l.value=e.sources.find((e=>e.file===t.params.id)),!l.value)return Promise.reject();a.currency=l.value.currency,a.isBucks=l.value.isBucks,await n(l.value.file)}catch(e){console.log(e)}}return B((()=>{c()})),C((()=>t.params.id),(e=>{a.points=[],O((()=>{c()}))})),(e,s)=>{const n=r("router-link");return u(),i(j,{name:"fade",appear:""},{default:ee((()=>[m("div",te,[m("header",ae,[m("div",se,[m(n,{class:"back-btn",to:x(t).query.from||"/"},null,8,["to"]),x(l)?(u(),i("div",le,[m("div",null,b(x(l).title),1),m("div",ne,b(x(l).short),1)])):f("",!0)])]),m("div",ue,[x(a).points&&x(a).points.length?(u(),i(Z,{points:x(a).points,duration:x(a).duration,id:x(t).params.id,key:x(t).params.id,currency:x(a).currency,year:x(l).year},null,8,["points","duration","id","currency","year"])):f("",!0)])])])),_:1})}},__scopeId:"data-v-1bb6e375"};const re=L();c("data-v-029f72ae");const ce={class:"container"},oe=m("h1",{class:"h1"},"Выберите компанию",-1),de={class:"items is-full"},ye=m("h1",{class:"h1"},"Выберите компании",-1),ve={key:0,class:"items"};o();const pe={expose:[],setup(e){const t=F(),a=N();const s=y({items:[],isFullscreen:E.isFullscreen,selected:[],preSelected:[]}),l=v((()=>s.selected&&s.selected.length>0)),n=v((()=>s.preSelected.reduce(((e,t)=>(e[t]=t,e)),{}))),c=v((()=>s.items.filter((e=>-1!==s.selected.indexOf(e.file)))));function o(){a.push({query:{selected:s.preSelected}}),s.selected=s.preSelected,s.preSelected=[]}function d(){E.isEnabled&&(s.isFullscreen=!E.isFullscreen,E.toggle())}return B((async()=>{const e=await async function(){try{return await fetch("data/settings.json").then((e=>e.json()))}catch(e){}}();s.items=e.sources,s.selected=t.query.selected||[]})),C((()=>t.query.selected),(e=>{s.selected=t.query.selected||[]})),(e,a)=>{const y=r("router-link");return u(),i(j,{name:"fade",appear:""},{default:re((()=>[m("div",ce,[x(l)?(u(),i(y,{key:0,class:"back-btn",to:x(t).query.from||"/"},null,8,["to"])):f("",!0),m("button",{class:["fullscreen-icon",{off:x(s).isFullscreen}],onClick:d},null,2),x(l)&&x(s).items?(u(),i(g,{key:1},[oe,m("div",de,[(u(!0),i(g,null,k(x(c),(e=>(u(),i("div",{class:"item",style:{background:e.color},key:e.file},[m(y,{to:{path:`/${e.file}`,query:{from:x(t).fullPath}}},{default:re((()=>[w(b(e.title)+" "+b(e.year),1)])),_:2},1032,["to"])],4)))),128))])],64)):(u(),i(g,{key:2},[ye,x(s).items?(u(),i("div",ve,[(u(!0),i(g,null,k(x(s).items,(e=>(u(),i("div",{class:["item",{selected:x(n)[e.file]}],style:{background:e.color},key:e.file},[m("button",{type:"button",onClick:t=>function(e){-1===s.preSelected.indexOf(e)?s.preSelected.push(e):s.preSelected=s.preSelected.filter((t=>t!==e))}(e.file)},b(e.title)+" "+b(e.year),9,["onClick"])],6)))),128))])):f("",!0),x(l)?f("",!0):(u(),i("button",{key:1,type:"button",disabled:!x(s).preSelected.length,class:"button start-btn",onClick:o}," Далее ",8,["disabled"]))],64))])])),_:1})}},__scopeId:"data-v-029f72ae"},he=_({routes:[{path:"",component:pe},{path:"/:id",component:ie}],history:q()}),me=D(T);me.use(he),me.mount("#app");
